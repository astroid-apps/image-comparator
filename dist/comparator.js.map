{"version":3,"sources":["ImageComparator.js","comparator.js"],"names":["ImageComparator","elementId","imageUrlL","imageUrlR","captionL","captionR","width","barWidth","imgR","document","createElement","setAttribute","imgL","trimmedImgL","appendChild","bar","style","backgroundColor","capR","innerHTML","capL","slider","pos","shift","x","left","getBoundingClientRect","zIndex","right","mouseMove","e","pageX","div","preventDefault","addEventListener","cursor","window","removeEventListener","touchMoveStart","touches","length","touchMove","passive","getElementById","position","init","p","setImage","newImageUrlL","newImageUrlR","newCaptionL","newCaptionR"],"mappings":"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","file":"comparator.js","sourceRoot":"..\\src","sourcesContent":["/*\r\n\t画像比較\r\n\t\r\n\t2020/10/19 右側のキャプションの位置がずれる不具合を修正\r\n\t2020/07/02 キャプション追加\r\n\t2020/06/13 clipPathがIEでは未対応のため、trimmedImgLで囲ってtrimmedImgLのwidthを変更する方法を採用\r\n\t2020/06/12 モジュール化\r\n\t2020/06/06 作成開始\r\n*/\r\n\r\nexport function ImageComparator(elementId,imageUrlL,imageUrlR,captionL,captionR){\r\n\t\r\n\t//画像の表示幅(initで設定)\r\n\tlet width;\r\n\t\r\n\t//スライドバーの表示幅(initで設定)\r\n\tlet barWidth;\r\n\t\r\n\t//背景画像(外側divの高さがずれないようにvertical-alignを設定)\r\n\tconst imgR = document.createElement(\"img\");\r\n\timgR.setAttribute(\"style\",\"vertical-align:bottom;width:100%;\");\r\n\timgR.setAttribute(\"src\",imageUrlR);\r\n\t\r\n\t//上に重ねる比較画像(横幅は読み込み完了時にimgRの幅が決まり次第反映)\r\n\tconst imgL = document.createElement(\"img\");\r\n\timgL.setAttribute(\"style\",\"vertical-align:bottom;\");\r\n\timgL.setAttribute(\"src\",imageUrlL);\r\n\t\r\n\t//imgLをトリミングするためのdiv(横幅以上の部分はoverflow:hidden;で非表示)\r\n\tconst trimmedImgL = document.createElement(\"div\");\r\n\ttrimmedImgL.setAttribute(\"style\",\"position:absolute;z-index:1;top:0px;bottom:0px;left:0px;overflow:hidden;\");\r\n\ttrimmedImgL.appendChild(imgL);\r\n\t\r\n\t//境界線\r\n\tconst bar = document.createElement(\"div\");\r\n\tbar.setAttribute(\"style\",\"position:absolute;z-index:3;top:0px;height:100%;\");\r\n\tbar.style.backgroundColor = \"#cccccc\";\r\n\t\r\n\t//imgRキャプション\r\n\tconst capR = document.createElement(\"div\");\r\n\tcapR.setAttribute(\"style\",\"position:absolute;z-index:2;bottom:0px;padding:2px 2px 2px 2px;\");\r\n\tcapR.style.backgroundColor = \"#eeeeee\";\r\n\tcapR.innerHTML = captionR;\r\n\t\r\n\t//imgLキャプション\r\n\tconst capL = document.createElement(\"div\");\r\n\tcapL.setAttribute(\"style\",\"position:absolute;z-index:4;bottom:0px;padding:2px;\");\r\n\tcapL.style.backgroundColor = \"#eeeeee\";\r\n\tcapL.innerHTML = captionL;\r\n\t\r\n\t//マウス操作を受け付けるための最前面レイヤー\r\n\tconst slider = document.createElement(\"div\");\r\n\tslider.setAttribute(\"style\",\"position:absolute;z-index:5;top:0px;bottom:0px;left:0px;right:0px;\");\r\n\t\r\n\t//--------------------------------------------------\r\n\t//境界移動\r\n\t//--------------------------------------------------\r\n\t\r\n\t//境界位置(0.0～1.0)(画面サイズ変更後に復元するために、widthに対する割合を変数に記録)\r\n\tlet pos = 0;\r\n\t\r\n\tconst shift = function(x){\r\n\t\tif(x < 0) x = 0;\r\n\t\tif(x > width) x = width;\r\n\t\t\r\n\t\t//IEはclipPath未対応\r\n//\t\timgL.style.clipPath = \"inset(0px \" + (width - x) + \"px 0px 0px)\";\r\n\t\ttrimmedImgL.style.width = x + \"px\";\r\n\t\t\r\n\t\t//境界線を表示させる位置\r\n\t\tbar.style.left = x - barWidth / 2 + \"px\";\r\n\t\t\r\n\t\t//キャプションの位置\r\n\t\tif(capR.getBoundingClientRect().width + x + barWidth / 2 > width){\r\n\t\t\tcapR.style.left = width - capR.getBoundingClientRect().width + \"px\";\r\n\t\t\tcapR.style.zIndex = 2;\r\n\t\t\tcapL.style.zIndex = 4;\r\n\t\t}else{\r\n\t\t\tcapR.style.left = x + barWidth / 2 + \"px\";\r\n\t\t}\r\n\r\n\t\tif(x - barWidth / 2 - capL.getBoundingClientRect().width < 0){\r\n\t\t\tcapL.style.right = width - capL.getBoundingClientRect().width + \"px\";\r\n\t\t\tcapL.style.zIndex = 2;\r\n\t\t\tcapR.style.zIndex = 4;\r\n\t\t}else{\r\n\t\t\tcapL.style.right = width - (x - barWidth / 2) + \"px\";\r\n\t\t}\r\n\t\t\r\n\t\tpos = x / width;\r\n\t};\r\n\r\n\t//--------------------------------------------------\r\n\t//マウス操作(PC用)\r\n\t//--------------------------------------------------\r\n\t\r\n\tconst mouseMove = function(e){\r\n\t\tshift(e.pageX - div.getBoundingClientRect().left);\r\n\t\te.preventDefault();\r\n\t};\r\n\t\r\n\tslider.addEventListener(\"mousedown\", e => {\r\n\t\tslider.style.cursor = \"w-resize\";\r\n\t\twindow.addEventListener(\"mousemove\",mouseMove);\r\n\t\tmouseMove(e);\r\n\t});\r\n\t\r\n\twindow.addEventListener(\"mouseup\", e => {\r\n\t\tslider.style.cursor = \"default\";\r\n\t\twindow.removeEventListener(\"mousemove\",mouseMove);\r\n\t});\r\n\r\n\t//--------------------------------------------------\r\n\t//タッチ操作(スマートフォン用)\r\n\t//--------------------------------------------------\r\n\t\r\n\tconst touchMoveStart = function(e){\r\n\t\t\r\n\t\t//2点タッチ以上で停止\r\n\t\tif(e.touches.length == 1){\r\n\t\t\tshift(e.touches[0].pageX - div.getBoundingClientRect().left);\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tslider.addEventListener(\"touchmove\",touchMove,{passive: false});\r\n\t\t}else{\r\n\t\t\tslider.removeEventListener(\"touchmove\",touchMove,{passive: false});\r\n\t\t\tslider.removeEventListener(\"touchstart\",touchMoveStart,{passive: false});\r\n\t\t}\r\n\t};\r\n\r\n\tconst touchMove = function(e){\r\n\t\tshift(e.touches[0].pageX - div.getBoundingClientRect().left);\r\n\t\te.preventDefault();\r\n\t};\r\n\r\n\tslider.addEventListener(\"touchstart\",touchMoveStart,{passive: false});\r\n\r\n\tslider.addEventListener(\"touchend\", e => {\r\n\t\tif(e.touches.length == 1) slider.addEventListener(\"touchstart\",touchMoveStart,{passive: false});\r\n\t});\r\n\t\r\n\t//--------------------------------------------------\r\n\t//初期化\r\n\t//--------------------------------------------------\r\n\t\r\n\tconst div = document.getElementById(elementId);\r\n\t//html側で指定したstyleを残すために「setAttribute(\"style\",～)」は使わない\r\n\tdiv.style.position = \"relative\";\r\n\tdiv.appendChild(imgR);\r\n\t\r\n\tconst init = function(p){\r\n\t\twidth = imgR.width;\r\n\t\timgL.style.width = width + \"px\";\r\n\t\t\r\n\t\tbarWidth = width * 0.01;\r\n\t\tbar.style.width = barWidth + \"px\";\r\n\t\t\r\n\t\tdiv.appendChild(trimmedImgL);\r\n\t\tdiv.appendChild(bar);\r\n\t\tdiv.appendChild(capR);\r\n\t\tdiv.appendChild(capL);\r\n\t\tdiv.appendChild(slider);\r\n\t\t\r\n\t\tshift(width * p);\r\n\t};\r\n\t\r\n\twindow.addEventListener(\"load\", e => {\r\n\t\tinit(0.5);\r\n\t});\r\n\r\n\twindow.addEventListener(\"resize\", e => {\r\n\t\tinit(pos);\r\n\t});\r\n\t\r\n\t//--------------------------------------------------\r\n\t//画像差し替え機能\r\n\t//--------------------------------------------------\r\n\t\r\n\tthis.setImage = function(newImageUrlL,newImageUrlR,newCaptionL,newCaptionR){\r\n\t\timgL.setAttribute(\"src\",newImageUrlL);\r\n\t\timgR.setAttribute(\"src\",newImageUrlR);\r\n\t\tcapL.innerHTML = newCaptionL;\r\n\t\tcapR.innerHTML = newCaptionR;\r\n\t};\r\n};","\r\n\r\nimport {ImageComparator} from \"./ImageComparator.js\";\r\n\r\nwindow.ImageComparator = ImageComparator;\r\n\r\n\r\n"]}